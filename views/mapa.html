<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="../estilos/styleservicios.css" />
    <link rel="stylesheet" href="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.css" />
    <title>Traveler Assistant - Mapas Interactivos</title>
</head>
<body>
    <header>
        <h1>Mapa Interactivo - Traveler Assistant</h1>
    </header>

    <div id="map-container">
        <!-- Contenedor de Búsqueda -->
        <div id="search-container">
            <input type="text" id="search-input" placeholder="Escribe un lugar o dirección..." />
            <button id="search-button">Buscar</button>
        </div>

        <!-- Contenedor del Mapa -->
        <div id="map"></div>
    </div>

    <!-- Scripts -->
    <script src="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.js"></script>
    <script>
        // Configuración inicial de Mapbox
        mapboxgl.accessToken = 'pk.eyJ1IjoiZ3NoYW9vbGkiLCJhIjoiY20zczFtYjUxMGNyNTJzcTJzOTV4cng4aiJ9.oF07jEBIk7Vu2lxSyOHSlA';

        const map = new mapboxgl.Map({
            container: 'map',
            style: 'mapbox://styles/mapbox/streets-v11',
            center: [-99.1332, 19.4326], // Coordenadas iniciales (Ciudad de México)
            zoom: 12
        });

        // Control de navegación en el mapa
        const nav = new mapboxgl.NavigationControl();
        map.addControl(nav, 'top-right');

        // Agregar un marcador inicial
        const initialMarker = new mapboxgl.Marker({ color: 'red' })
            .setLngLat([-99.1332, 19.4326])
            .setPopup(new mapboxgl.Popup().setHTML('<h3>Ciudad de México</h3><p>Ubicación inicial</p>'))
            .addTo(map);

        // Función para realizar búsqueda de lugares
        document.getElementById('search-button').addEventListener('click', function () {
            const query = document.getElementById('search-input').value.trim();
            if (!query) {
                alert('Por favor, escribe una ubicación para buscar.');
                return;
            }

            const geocodeUrl = `https://api.mapbox.com/geocoding/v5/mapbox.places/${encodeURIComponent(query)}.json?access_token=${mapboxgl.accessToken}`;

            fetch(geocodeUrl)
                .then(response => response.json())
                .then(data => {
                    if (data.features && data.features.length > 0) {
                        const [lng, lat] = data.features[0].geometry.coordinates;

                        // Centrar el mapa en la nueva ubicación
                        map.flyTo({ center: [lng, lat], zoom: 14 });

                        // Agregar marcador
                        new mapboxgl.Marker({ color: 'blue' })
                            .setLngLat([lng, lat])
                            .setPopup(new mapboxgl.Popup().setHTML(`<h3>${data.features[0].place_name}</h3>`))
                            .addTo(map);
                    } else {
                        alert('No se encontraron resultados para tu búsqueda.');
                    }
                })
                .catch(error => console.error('Error en la búsqueda:', error));
        });

        // Evento de clic en el mapa para obtener coordenadas y geocodificación inversa
        map.on('click', function (e) {
            const { lng, lat } = e.lngLat;

            const reverseGeocodeUrl = `https://api.mapbox.com/geocoding/v5/mapbox.places/${lng},${lat}.json?access_token=${mapboxgl.accessToken}`;

            fetch(reverseGeocodeUrl)
                .then(response => response.json())
                .then(data => {
                    if (data.features && data.features.length > 0) {
                        new mapboxgl.Popup()
                            .setLngLat([lng, lat])
                            .setHTML(`<h3>${data.features[0].place_name}</h3>`)
                            .addTo(map);
                    } else {
                        alert('No se encontraron resultados para estas coordenadas.');
                    }
                })
                .catch(error => console.error('Error en la geocodificación inversa:', error));
        });
    </script>
</body>
</html>
